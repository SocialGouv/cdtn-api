include:
  - project: SocialGouv/gitlab-ci-yml
    file: /autodevops.yml
    ref: v17.0.0-beta.35

#

workflow:
  rules:
    # Skip GitHub pull requests pipelines
    - if: $CI_PIPELINE_SOURCE == 'external_pull_request_event'
      when: never
    # Otherwise include the job and set to run normally
    - when: always

#

variables:
  AUTO_DEVOPS_RELEASE_AUTO: "ðŸ”–"
  AUTO_DEVOPS_PRODUCTION_AUTO: "ðŸš€"

Install:
  after_script:
    # Removes ~400M
    - yarn cache clean @socialgouv/kali-data
    # Removes ~150M
    - yarn cache clean @socialgouv/legi-data

Build:
  script:
    - echo "look ma, no build"

Register image:
  extends: .autodevops_register_image
  variables:
    DOCKER_BUILD_ARGS: >-
      --shm-size 1g

Register init image:
  extends: .autodevops_register_image
  variables:
    IMAGE_NAME: $CI_REGISTRY_IMAGE/init
    DOCKER_BUILD_ARGS: >-
      --file init.Dockerfile
      --shm-size 1g
